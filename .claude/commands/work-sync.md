# Sync Work Session with Issue Tracker

Synchronize a work session file with its linked issue tracker and update WORK.org status.

**Parameter:** $ARGUMENTS (optional - WORK file name or uses current session)

## Instructions:

### 1. Identify Work File

#### With parameter:
- If $ARGUMENTS matches `WORK-*.org`, use that file from ./work/
- Verify the file exists

#### Without parameter:
- Find the most recently modified WORK-*.org file in ./work/
- Or identify the "current" session (one with STRT tasks or recent work log entries)
- Confirm with user if multiple candidates exist

### 2. Read Sync Configuration

Check WORK.org "Sync Configuration" section for:
- Primary tracker type (GitHub, JIRA, Linear, etc.)
- Authentication method preferences
- API endpoints or project settings
- Auto-sync preferences

### 3. Extract Issue Information

From the work file's :PROPERTIES: section, extract:
- :JIRA: link
- :GITHUB: link  
- :LINEAR: link
- :NOTION: link
- Any other issue tracker URLs

If no issue link found, skip to step 6 (WORK.org update only).

### 4. Attempt Issue Tracker Sync

#### A. Check for MCP Tools (Priority 1):
```
- Look for tools starting with "mcp__" that match the tracker type
- Examples: mcp__github, mcp__jira, mcp__linear
- Use these tools to update the issue with work session status
```

#### B. Try CLI Tools (Priority 2):
```
For GitHub:
- Use `gh issue comment` or `gh issue edit`
- Check `gh auth status` first
- If auth fails, inform user: "Run `gh auth login` to authenticate"

For JIRA:
- Use `jira issue comment` or API calls
- Check for JIRA_API_TOKEN environment variable

For Linear:
- Use Linear CLI if available
- Check for LINEAR_API_KEY environment variable
```

#### C. Use Web APIs (Priority 3):
```
- Construct API requests based on tracker type
- Use credentials from environment variables
- Never store credentials in files
- If auth fails, provide specific fix instructions
```

### 5. Sync Content

#### What to sync TO issue tracker:
```
Status Update:
- Work Session: WORK-[description]
- Progress: X of Y tasks completed
- Recent Activity:
  [Last 2-3 work log entries summarized]
- Next Steps: [Pending tasks]
- Blockers: [Any BLOCKED items]

Generated by dev-agent-work tracking system
```

#### What to sync FROM issue tracker:
```
- Updated status (if changed externally)
- New comments or requirements
- Priority changes
- Assignment changes
```

### 6. Update WORK.org

Ensure the work session is properly reflected in WORK.org:

#### For Active Work:
```org
** TODO [[file:work/WORK-name.org][Description]]
   :PROPERTIES:
   :CREATED:  [date]
   :PRIORITY: A/B/C
   :SYNCED:   [current timestamp]
   :END:
   - Status: In progress (X/Y tasks complete)
   - Last activity: [most recent work log summary]
   - Issue: [[URL][Ticket ID]]
```

#### For Completed Work:
Move to "Completed Work Sessions" section with:
- Completion date
- Key accomplishments
- Link to issue (marked as resolved)

#### For Blocked Work:
Move to "Blocked/Paused Work" section with:
- Blocker description
- Dependencies
- Link to issue (marked as blocked)

### 7. Handle Sync Failures

If sync fails at any step:

#### Authentication Issues:
```
"Unable to sync with [Tracker]: Authentication required

To fix:
- For GitHub: Run `gh auth login`
- For JIRA: Set JIRA_API_TOKEN environment variable
- For Linear: Set LINEAR_API_KEY environment variable

Or configure MCP server for [Tracker] if available."
```

#### Configuration Issues:
```
"No issue tracker link found in WORK-[name].org

To enable sync:
1. Add tracker URL to file properties
2. Configure tracker settings in WORK.org Sync Configuration section"
```

#### Network/API Issues:
```
"Failed to connect to [Tracker] API

- Check network connection
- Verify API endpoint in WORK.org configuration
- Try again with --verbose flag for details"
```

### 8. Sync Report

After sync attempt, report:
```
Sync Summary for WORK-[name]:
✓ WORK.org updated
✓/✗ Issue tracker sync: [status]
  - Tracker: [type]
  - Issue: [ID/URL]
  - Method used: [MCP/CLI/API]
  - Last sync: [timestamp]
  
[Any warnings or required actions]
```

### 9. Store Sync Metadata

Update work file with sync information:
```org
:LAST_SYNC: [timestamp]
:SYNC_STATUS: success/partial/failed
:SYNC_METHOD: mcp/cli/api
```

## Configuration Storage

If user provides new configuration during sync:
1. Update WORK.org Sync Configuration section
2. Preserve for future syncs
3. Never store passwords/tokens (only references to env vars)

## Expected Behavior:

- Seamless sync when tools available
- Clear instructions when configuration needed
- Graceful fallback through multiple sync methods
- Always updates local WORK.org even if remote sync fails
- Preserves configuration for future use